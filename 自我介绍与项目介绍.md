# 自我介绍与项目介绍

## &sect; 自我介绍

你好，我是杜嘉诚，本科就读于电子科技大学信通学院网络工程系，目前也在同专业读研，2021年应届毕业生。我在学校学习与科研之余，我自学了java语言以及后端开发相关知识，并经常记录与总结，利用typora和github/gitee实现了一个操作很简单的自制的云笔记吧哈哈哈，不过还是有图床好。也时常将某些笔记发布到csdn社区，并且部署了一个开源的博客系统搭建了自己的个人博客，虽然没啥人看哈哈哈哈。

项目：

- 并跟随网络上的教程做了一个基于Spring Boot的微信点餐系统，从中学习到了很多后端开发相关的知识，比如，<font color='#02C874'>**首先是基于spring boot搭建web应用的基本流程。RESTful前后端分离架构，分层领域模型的使用DTO VO什么的，dao使用jpa，以及Mysql与redis，集中式session、日志、redis分布式锁 ，基于spring aop和全局统一异常处理和微信登录第三方skd的一个登录校验，也了解了微信登录授权流程。基于消息队列实现异步，实现事件驱动的微服务架构（这里要说虽然异步比较优雅，但这里还是问题比较多，提升了系统的复杂性，要考虑各种一致性，幂等性，有序性，消息丢失等问题）。还有基于docker的一些部署。**</font>

- <font color='#02C874'>**然后根据自己学习的springcloud相关知识以及一些组件，将该项目又进行了微服务化的改造，实现了服务注册发现，统一配置中心，网关限流，熔断等基础功能。然后加强巩固了一下微服务各种组件的原理吧**</font>

- 而且由于并发也很有兴趣，于是我又在此基础上实现了一个秒杀服务，主要解决秒杀过程中的超卖问题，通过使用redis手动实现一个分布式锁保证并发安全问题。以及使用rabbitmq异步化。

------

学校项目：研究Ad Hoc网络中的基于强化学习的路由方法。以求多业务，低开销，低时延。研究过程中发了一个专利，一篇会议，以及中了一篇会议。



愿景：

希望自己能投身如更大的项目中去，因为我知道有很多东西，需要在特定的场景中才能更好的领会，而在大的项目中，开发应用部署应用等方面应该有很多更新奇有趣更高端的方法与技术的涉及，这让我非常的想尝试，即使是一颗螺丝钉，但也可以在工作的时候对项目有自己更多的思考，毕竟这些是我在自己diy项目中学不到的。



------

## &sect; 项目挖掘，层层递进（为什么要xxx？）

### 为什么使用spring boot？

> - 它是用来开发spring独立应用的框架。
> - 便于部署：内置了tomcat，打包成jar可直接运行，无需打包war包并部署在tomcat中。
> - <font color='#02C874'>**简化配置，无需xml配置。starter简化依赖**</font>

------



### 为什么前后端分离？

> 解耦前后端的开发，维护，部署，不过现实中不能为了分离而分离，分离还是需要成本的。我这边是教程中把微信那边的前端页面做了，提供了api文档供后端使用，所以我相当于开发后端。

------

### 为什么要用分层领域模型？

> 可以让程序更加健壮，<font color='#02C874'>**降低系统各层耦合性，各层使用的是DO的不同派生，如果此时数据库中有了表或字段的修改，则需要修改DO，这时，如果某些层如DTO中没用到该字段，则无需修改。这样降低了耦合**</font>。
>
> 代价是：<font color='#02C874'>**要手写各种转换方法在各层对象之间转换：利用`BeanUtils.copyProperties`。**</font>

------

### 为什么使用JPA？

> <font color='#02C874'>***开发更加方便，而且有实现DDD领域驱动规范的潜力，更加的OO，符合微服务架构下的需求。***</font>

------

### 日志框架?

>  slf4j + logback，使用lombok简化操作，听说可用els搞日志，分布式中可用graylog。

------

### 先说基于单体应用的基于Spring aop的统一异常处理的微信授权登陆？

> - <font color='#02C874'>**创建Aspect切面类**</font>，里面通过excution表达式定义出切点，然后定义before通知，里面对权限进行校验：若cookie中不包含token，则抛出自定义异常，否则拿着token作为key去redis中找看有无对应数据，如无，也抛异常，反之无事发生。（这里redis存着的是以UUID为key，openid为value的键值对。）
> - <font color='#02C874'>**创建自定义异常类**</font>，继承RuntimeException即可，无需多定义其他。
> - <font color='#02C874'>**定义异常处理类**</font>，类上需加`@ControllerAdvice`注解。内部定义处理方法，标注`@ExceptionHandler(value = SellerAuthorizeException.class)`注解，表明是处理哪个异常的方法，该方法返回ModeAndView对象，就相当于跳转到扫码登录地址，该地址中returnUrl为 登录login接口。因为扫码后会走微信授权的一系列流程后最终会携带openid来访问returnUrl，***所以login接口要接收openid参数，并将其存入数据库，然后写入redis，<UUID，openid>。并将UUID写入Cookie***。login接口最终跳转到的是指定页面，买家端商品列表。
> - 说说微信授权？

------

### 再说说微服务改造后的权限验证？

> 自定义一个filter，用来从redis验证是否登录，只是没有execution表达式了，**需要在shouldFilter方法中对uri进行判定来决定是否需要鉴权。如果已经登录了，就无事发生。如果发现没有登录，则重定向到微信扫码登录界面。**
>
> > <font color='red'>**这里有一个难点：重定向**</font>，涉及到zuul中各种filter的触发条件，filter的执行顺序（filterType，filterOrder）层层过滤器的方法的追踪，最后找到需要修改的东西。**首先需要设置相应字段屏蔽某些过滤器的执行，然后设置RequestContext中的某字段，触发SendForwardFilter过滤器。过滤器是否执行是要shouldFilter方法判断的，所以要看那些自带过滤器的触发条件，以实现控制他们是否起作用。**

------



### 利用redis做了些什么？

> - ### 做缓存：
>
>   在方法上标记注解，将注解的返回值缓存入redis，注解一定要手动设置key值，否则会自动按函数参数来作为redis中的key，这样不可控。而为了将key动态化，并且不同入参的返回值相同的函数也要用相同的key，可以使用spel表达式来表示key。如：
>
>   ```java
>   @Override
>       @Cacheable(key = "#productId")
>       public ProductInfo findById(String productId) {
>           return dao.findById(productId).get();
>       }
>     
>       @Override
>       @CacheEvict(key = "#productInfo.getProductId()")
>       public ProductInfo save(ProductInfo productInfo) {
>           return dao.save(productInfo);
>       }
>   ```
>
>   > 这里使用@CacheEvict，当执行完方法后可以删除缓存，保证数据库双写一致性。
>
>   ------
>
>   
>
> - ### 集中式session：
>
>   涉及到用户（登录）状态的存储，以及微服务下应用集群化后，session的管理问题，这就涉及到分布式系统下的session管理。包括==**session sticky、session复制、集中式session。**==这里session处理就是上文登录信息在redis中的存储，<UUID，openid>。
>
> - ### <font color='red'>**分布式锁**</font>：
>
>   自己手动实现了一个简单的，用于解决分布式系统中秒杀问题中的==超卖(利用 ab压测工具测试)==。首先优于synchronized的粒度，秒杀不同商品就无须上锁。其次，分布式系统中，基于单机jvm层面的诸如synchronized和cas原子等操作都无法满足，所以需要分布式锁。
>
>   - > <font color='red'>**这里有个挖掘点**</font>：避免加锁后没有正常解锁，redis中存值为==<productId，time>==，其中time为加锁的当前时间➕超时时间。所以加锁操作除了判断当前productId是否已在redis中存在，若无则直接加锁成功，并将数据写入redis，若已存在，则get出oldtime1，<font color='#02C874'>***判断若超时，则利用getAndSet命令，将新值set进去，旧值oldtime2返回，然后判断oldtime1是否与oldtime2相等，若相等，则锁获取成功，若不相等，说明有另一个线程捷足先登了，这里是一个易错点。***</font>

------

### 利用消息队列做了点什么？

> <font color='red'>***异步调用实现微服务中的事件驱动。***</font>不过也会带了很多的一致性问题，<font color='#02C874'>如更新了数据库与事件（消息）的发布之间的同步问题。主要有两个解决的方向：</font>
>
> 1. **==保证同步==**：比如等更新数据库的事务成功执行完毕再发送消息；或在数据库维护一张“待发送消息表”，当数据库成功写入更新后，就也写一条消息数据到待发送消息表中，另搞一个线程来监听这张表，从而去发送消息。这样的方法确实保证了一致性，但却牺牲了一些异步的效率。
> 2. ==**事件源方式**==：每条数据搞一个状态字段，表示很多种状态，如（创建的，已批准的，已发货的，取消的），这样可全异步，收到请求，异步进行数据库更新和消息发送，等数据库更新成功后，再发送消息来异步调用服务来更改数据库中字段的状态。这种方式的重点就是要设计好状态之间的切换以及行为。

------



### 以秒杀为例说一下异步（消息队列）遇到的问题？

> <font color='#02C874'>**redis来存秒杀商品的库存，并实现分布式锁。rabbitmq用来实现秒杀接口异步调用下单接口（order服务）进行下单**</font>，下单服务可以使用cas自旋保证成功，尽量不要失败，或者消息持久化，反正铁板钉，人家秒杀符合条件就必须满足人家。若允许失败，则秒杀服务监听消息队列中订单失败消息，下单服务若失败则返回订单失败消息，秒杀服务收到后，把redis库存返还回去。<font color='#02C874'>（***我觉得异步的过程的话，通常有一部分成功的话，尽量用cas自旋或消息队列持久化，反正尽量保证其他部分也要成功，因为一方成功便证明了成功的合理性，既然合理，就应该为用户满足。***）</font>

------



### 利用了Spring cloud 哪些组件，都做了些什么？

> - eureka：做为注册中心，互相之间可相互注册实现高可用。
> - config：统一配置中心，结合spring cloud bus、rabbitmq 和webhooks实现自动拉取配置，灰常方便，需要@RefreshScope注解的类所配置的属性(@ConfigurationProperties)才能自动更新。（<font color='#02C874'>***github通过webhooks调用bus提供的刷新接口，该接口会把配置更新消息通过总线投递给每个整合了总线和rabbitmq的服务）***</font>
> - zuul：上面的登录验证重定向，以及限流。
> - hytrix：对服务调用进行监控，出错后及时fallback<font color='purple'>***（fail-fast机制：指的是当有异常或者错误发生时就立即中断执行的这种设计，集合中的该机制思想如出一辙）***</font>，保证服务的高可用，防止==**服务雪崩和缓存雪崩**==。<font color='#02C874'>***通过线程池来实现资源隔离和限流熔断并触发降级。***（**其实服务雪崩究其原因就是服务的同步调用，如果是异步调用，这样的问题就会少些吧**）</font>。<font color='purple'>***底层对不同服务调用抽象为不同Command，并使用不同的线程池，<key, 线程池>的形式存入ConcurrentHashMap。这里可以引出ConcurrentHashMap来聊聊***</font>

------



### 部署方面Docker有什么说的吗？

> 我主要是将mysql、redis、rabbitmq利用docker部署，

------



### 难点：

> - redis和消息队列的“回滚”要自己手动去做，spring 事务是解决不了的。
> - redis分布式锁的防止死锁
> - <font color='#02C874'>***各种东西之间的权衡，如异步解耦的程度，比如下单和口库存如果全部异步，那就需要有好的异常处理，复杂度会提升。锁的粒度、必要性等。***</font>

------



## &sect; 开放性问题

1. 工作中遇到的最大挫折是什么，说说得与失？：

   学长因为去工作，甩锅给我，当时ns3我不熟悉，她说她基本功能都实现了，然后也和导师说，我接下来只需要很少的工作，结果我拿到后发现，只是接口定义好了，编译通过了而已。然后老师后面催的很紧，而我当时也没好意思和老师说学姐并没做那么多，因为那样的话老师就会把她喊回来不让她实习了，于是我夜夜笙歌了，写代码写到嗨，短时间内速成ns3并入门了c++。也<font color='red'>锻炼了自己的抗压能力。</font>

2. 最近有没有学习过新技术？

   首先是学校项目学习：CNN。

   打算学习分布式的东西，SOA, serverless无服务器架构，dubbo和zookeeper都还没搞过

3. 有什么想问我的？

   学习的建议？

4. 三年到五年的职业规划？

   首先夯实技术基础，拓宽技术视野，业务也要了解，不做脱离业务的开发，加强分布式于领域驱动模型。

   与同事合作，交流，请教。

5. 有什么缺点：要说与岗位无关的。比如说有些事情容易忘，我就会一想到什么就先记下来，设置提醒。

   或者从某一技术角度说，因为这种缺陷容易进步，如说，<font color='red'>我现在对分布式并发，以及业务系统应用的整体架构，行业的整体分析把控还不到位，还停留在较低的层次，需要工作中多加学习思考。</font>